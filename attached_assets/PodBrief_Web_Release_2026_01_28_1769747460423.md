**PodBrief v2.1 — As-Built System Documentation**

**Document Version:** 2.1

**Generated:** January 28, 2026

**Environment:** Production (Dual Environment: Test \+ Live)-----**1\. Product Overview**

**PodBrief** is an **AI-Powered Podcast Player & Summarizer** designed for busy professionals and casual podcast listeners. It provides both a full-featured podcast player and the ability to transform any podcast episode into high-density, actionable briefs containing structured text summaries, AI-condensed transcripts, and premium text-to-speech audio.

**Core Value Proposition**

* **Input:** Any podcast episode from the Taddy catalog (2+ million shows)  
* **Output:** A structured AI summary, AI-condensed transcript, full timestamped transcript, and premium TTS audio  
* **Dual Modes:** Use as a traditional podcast player OR generate AI summaries  
* **Design Philosophy:** **Waterfall Pipeline.** Brief generation follows a sequential automation flow: Transcribing → Summarizing → Recording → Completed. Content is deduplicated at the episode+language level via master\_briefs.

**Technology Stack**

| Layer | Technology |
| :---: | :---: |
| Frontend | React 18, TypeScript, Vite, Tailwind CSS |
| UI Components | Radix UI (shadcn/ui) |
| Backend | Lovable Cloud (Supabase) |
| Database | PostgreSQL (via Supabase) |
| Edge Functions | Deno (\~40 deployed functions) |
| AI Intelligence | Google Gemini 3 Flash Preview |
| Podcast Data | Taddy API |
| Text-to-Speech | OpenAI TTS-1 |
| Transactional Email | Resend |
| Marketing Automation | Loops.so |
| Payments | Stripe (Subscriptions \+ Credit Packs) |
| Analytics | PostHog \+ Custom Analytics Tables |

**Technology Stack (based on User Flow)**

| Step | Action | Tech Provider |
| ----- | ----- | ----- |
| **1\. Search** | User finds podcast/episode in the UI | **Taddy API** |
| **2\. Fetch** | System grabs metadata and transcript JSON | **Taddy API** |
| **3\. Summarize** | AI generates condensed transcript \+ executive brief | **Gemini 3 Flash** |
| **4\. Narrate** | AI generates premium audio summary | **OpenAI TTS-1** |
| **5\. Deliver** | Brief notification arrives in user's inbox | **Resend** |
| **6\. Sync** | User engagement synced to marketing platform | **Loops.so** |

**2\. Feature Audit — Active Features**

**2.1 Core User Flow**

* **Authentication:** Email/Password signup with first name capture, Google SSO supported  
* **Language Setup Modal:** Captures preferred language for SSO users on first login  
* **Podcast Search:** Discover shows by name, topic, or host via Taddy API  
* **Shows Management:** Follow/unfollow podcast series ("Add/Remove to/from My Shows")  
* **New Episodes Feed:** Chronological feed of recent episodes from followed shows  
* **Episode Saving:** Save episodes to Library for free (no credit required)  
* **Brief Generation:** One-click generation for any episode (costs 1 credit)  
* **Two-Pass AI Summarization:**  
  * Phase 1 (Extraction): Creates timestamped "AI Condensed Transcript"  
  * Phase 2 (Synthesis): Creates \<1000 word "Executive Brief"  
* **Multi-language Support:** Supports regeneration in 12 languages  
  * Chinese, Dutch, English, French, German, Italian, Japanese, Korean, Polish, Portuguese, Russian, Spanish  
* **Premium Audio Briefs:** OpenAI TTS-1 generated audio with configurable voice  
* **Dual Audio Playback:** Play either the AI-generated brief audio OR the original full episode  
* **Library with Tabs:**  
  * **Episodes Tab:** Saved full podcast episodes (free to save)  
  * **Briefs Tab:** AI-generated summaries (costs 1 credit each)  
* **Brief Sharing:** Public shareable links with personalized ?sharedBy=Name parameter  
* **Gifted Briefs:** Claim shared briefs without credit deduction  
* **Episode Sharing:** Share episode pages to friends

**2.2 Audio Player**

* **Desktop:** Persistent bottom bar with progress, volume control, speed selector (0.5x \- 2x), skip ±15s  
* **Mobile:** Mini player bar \+ expandable drawer view with full controls  
* **Features:**  
  * Audio caching (IndexedDB for offline resilience)  
  * Progress persistence across sessions  
  * PWA support with iOS audio hints  
  * Nine playback speeds: 0.5x, 0.75x, 0.9x, 1x, 1.1x, 1.25x, 1.5x, 1.75x, 2x  
  * iOS background audio persistence via singleton HTMLAudioElement

**2.3 Subscription & Billing**

* **Free Tier:** 5 credits (one-time) \+ unlimited podcast listening  
* **Pro Plan:** $19/month for 30 credits  
* **Credit Refill Packs:** 10 credits for $5 (one-time purchase)  
* **Stripe Checkout:** Secure hosted checkout  
* **Customer Portal:** Self-service billing management  
* **Immediate Cancellation:** Subscriptions terminate instantly upon request  
* **Credit Retention:** Users retain existing credits after cancellation

**2.4 SEO Pages**

* **Show Discovery Pages:** /show/:slug \- Public landing pages for podcast series  
* **Episode Detail Pages:** /episode/:slug \- Public landing pages for individual episodes  
* **Brief Pages:** /brief/:slug \- Shareable brief pages (truncated for unauthenticated users)  
* **Show Briefs Index:** /show/:slug/briefs \- Paginated list of all briefs for a show  
* **Show Episodes Index:** /show/:slug/episodes \- Paginated list of all episodes for a show  
* **Shows Directory:** /shows/directory \- Paginated directory of all indexed shows  
* **Explore Page:** /explore \- Curated discovery page

**2.5 Admin Features**

* **User Management** (/admin/users): Search, edit credits/plan, delete users  
  * Columns: Email, Credits, Plan, Searches, Shows, Episodes, Briefs, Link Visits, Referrals, Visits, Last Seen, Created  
* **Briefs Dashboard** (/admin/briefs): View all briefs across users, monitor pipeline status  
* **Analytics Dashboard** (/admin/analytics):  
  * Briefs Tab: Total briefs, plays, completions, audio length metrics, activity charts  
  * Shares Tab: Share initiation and link visit tracking  
  * Revenue Tab: Payment tracking  
* **Performance Dashboard** (/admin/performance): API latency tracking with pagination  
  * Metrics: Total Latency, Gemini Extract, Gemini Synth, TTS  
  * Table: Date, Episode, Action, Duration, Status  
* **Cost Monitoring** (/admin/costs): TTS and AI summarization cost analysis per brief  
* **Error Observability** (/admin/errors): Critical error logs with resolution workflow  
* **AI Configuration** (/admin/config): Edit prompts, temperatures, TTS voice, summary footer

**3\. Public Marketing Pages**

**3.1 Landing Page (Index)**

* **Hero Section:**  
  * Headline: "Listen to Podcasts. Or Their Summaries."  
  * Subheadline: "PodBrief is an intuitive podcast player that allows you to listen to full episodes or AI-narrated summaries of any podcast."  
  * CTA: "Start Listening Free" → /signup  
  * Note: "5 free AI summaries included. No credit card required."  
* **Features Section ("How It Works"):**  
  * **Free Podcast Player:**  
    * Stream millions of episodes from your favorite shows  
    * Follow your favorite shows and build your personal feed  
    * Save episodes to listen to later and mark episodes as completed  
  * **AI Podcast Summarizer:**  
    * Turn hour-long episodes into 5-minute briefs  
    * Read or listen to AI summaries on the go  
    * Summaries available in 10+ languages

**3.2 Pricing Page**

* **Free Tier Features:**  
  * Unlimited podcast listening  
  * Follow unlimited shows  
  * Build your episode library  
  * 5 AI summaries included  
* **Pro Plan Features ($19/month):**  
  * 30 credits per month. 1 credit \= 1 AI generated brief, which includes:  
    * Full episode transcription  
    * AI-condensed transcript  
    * AI-generated summary for reading  
    * AI-narrated summary for listening  
    * Download audio for offline listening  
    * Translation to 10+ languages  
    * Ability to share briefs with friends at no cost to either party  
* **Interactive ROI Calculator:**  
  * Inputs: Average podcast length, podcasts per week, value of time ($/hr)  
  * Fixed: Average summary length (7.5 min based on real data)  
  * Outputs: Hours saved/month, value of time, net savings, ROI multiplier

**3.3 Other Public Pages**

* **FAQ** (/faq): Common questions about credits, features, offline listening  
* **Privacy Policy** (/privacy): 2026 compliant, Chicago jurisdiction  
* **Terms of Service** (/terms): 2026 compliant, 13+ age requirement  
* **Install** (/install): PWA installation guide

**4\. Data Architecture**

**4.1 Database Tables (17 Total)**

**profiles Table**

| Column | Type | Default | Description |
| ----- | :---: | :---: | :---: |
| id | uuid | — | References auth.users(id) |
| email | text | — | User's email |
| email\_canonical | text | — | Normalized email (Gmail dots removed) |
| first\_name | text | null | User's first name |
| credits | integer | 5 | Remaining brief credits |
| plan | text | 'free' | 'free' or 'pro' |
| preferred\_language | text | 'en' | Default summary language |
| pro\_expires\_at | timestamptz | null | Subscription renewal date |
| subscription\_cancel\_at | timestamptz | null | Scheduled cancellation date |
| referred\_by | uuid | null | Referrer profile ID |
| created\_at | timestamptz | now() | Account creation |
| updated\_at | timestamptz | now() | Last profile update |

**master\_briefs Table**

| Column | Type | Default | Description |
| ----- | :---: | :---: | :---: |
| id | uuid | gen\_random\_uuid() | Primary key |
| slug | text | — | URL-friendly identifier |
| episode\_slug | text | — | Reference to episode\_metadata |
| taddy\_episode\_uuid | text | — | Unique Taddy episode ID |
| taddy\_podcast\_uuid | text | — | Taddy podcast series ID |
| episode\_name | text | — | Episode title |
| podcast\_name | text | — | Podcast series name |
| episode\_thumbnail | text | — | Episode artwork URL |
| episode\_audio\_url | text | — | Original podcast audio stream URL |
| episode\_published\_at | timestamptz | — | Episode publish date |
| episode\_duration\_seconds | integer | — | Original episode length |
| transcript\_content | text | — | Full timestamped transcript |
| ai\_condensed\_transcript | text | — | Phase 1 AI extraction output |
| summary\_text | text | — | Phase 2 AI synthesis output |
| summary\_phase | text | — | Current summarization phase |
| audio\_url | text | — | TTS audio storage path |
| audio\_status | text | 'none' | pending/processing/completed/failed |
| audio\_duration\_seconds | integer | — | TTS audio length |
| language | text | 'en' | Summary language code |
| pipeline\_status | text | 'pending' | Overall pipeline state |
| pipeline\_error | text | — | Error message if failed |
| pipeline\_completed\_at | timestamptz | — | Pipeline completion timestamp |
| processing\_lock\_holder | text | — | Lock for concurrent processing |
| source | text | 'taddy' | Content source |
| created\_at | timestamptz | now() | Record creation |
| updated\_at | timestamptz | now() | Last update |

**user\_briefs Table**

| Column | Type | Default | Description |
| ----- | :---: | :---: | :---: |
| id | uuid | gen\_random\_uuid() | Primary key |
| user\_id | uuid | — | Owner reference |
| master\_brief\_id | uuid | — | FK to master\_briefs |
| slug | text | — | User-specific URL slug |
| is\_completed | boolean | false | User's completion status |
| is\_hidden | boolean | false | Soft delete flag |
| is\_gifted | boolean | false | Claimed via share link |
| audio\_progress\_seconds | integer | 0 | Playback position |
| preferred\_language | text | 'en' | User's language preference |
| total\_duration\_minutes | integer | — | Cached duration |
| created\_at | timestamptz | now() | Record creation |
| updated\_at | timestamptz | now() | Last update |

**saved\_episodes Table**

| Column | Type | Default | Description |
| ----- | :---: | :---: | :---: |
| id | uuid | gen\_random\_uuid() | Primary key |
| user\_id | uuid | — | Owner reference |
| taddy\_episode\_uuid | text | — | Taddy episode ID |
| taddy\_podcast\_uuid | text | — | Taddy podcast ID |
| episode\_name | text | — | Episode title |
| podcast\_name | text | — | Podcast name |
| episode\_thumbnail | text | — | Episode artwork |
| episode\_audio\_url | text | — | Audio stream URL |
| episode\_duration\_seconds | integer | — | Episode length |
| episode\_published\_at | timestamptz | — | Publish date |
| audio\_progress\_seconds | integer | 0 | Playback position |
| is\_completed | boolean | false | Completion status |
| created\_at | timestamptz | When saved |  |
| updated\_at | timestamptz | Last update |  |

**followed\_podcasts Table**

| Column | Type | Description |
| ----- | :---: | :---: |
| id | uuid | Primary key |
| user\_id | uuid | Owner reference |
| taddy\_podcast\_uuid | text | Taddy podcast series ID |
| podcast\_name | text | Series name |
| podcast\_description | text | Series description |
| podcast\_image\_url | text | Series artwork |
| author\_name | text | Host/author name |
| total\_episodes\_count | integer | Episode count |
| created\_at | timestamptz | When followed |
| updated\_at | timestamptz | Last update |

**podcast\_metadata Table**

| Column | Type | Description |
| ----- | :---: | :---: |
| id | uuid | Primary key |
| taddy\_podcast\_uuid | text | Unique Taddy ID |
| slug | text | SEO-friendly URL slug |
| name | text | Podcast name |
| description | text | Podcast description |
| image\_url | text | Artwork URL |
| author\_name | text | Host/author |
| total\_episodes\_count | integer | Episode count |
| created\_at | timestamptz | Record creation |
| updated\_at | timestamptz | Last update |

**episode\_metadata Table**

| Column | Type | Description |
| ----- | :---: | :---: |
| id | uuid | Primary key |
| taddy\_episode\_uuid | text | Unique Taddy ID |
| taddy\_podcast\_uuid | text | Parent podcast ID |
| slug | text | SEO-friendly URL slug |
| name | text | Episode name |
| podcast\_name | text | Parent podcast name |
| podcast\_slug | text | Parent podcast slug |
| podcast\_image\_url | text | Podcast artwork (fallback) |
| description | text | Episode description |
| image\_url | text | Episode artwork |
| audio\_url | text | Audio stream URL |
| duration\_seconds | integer | Episode length |
| published\_at | timestamptz | Publish date |
| master\_brief\_id | uuid | FK to master\_briefs (if briefed) |
| created\_at | timestamptz | Record creation |
| updated\_at | timestamptz | Last update |

**analytics\_events Table**

| Column | Type | Description |
| ----- | ----- | ----- |
| id | uuid | Primary key |
| event\_type | text | Event type (see below) |
| user\_id | uuid | User reference |
| brief\_id | uuid | Optional brief reference |
| language | text | Language code for events |
| metadata | jsonb | Additional context |
| created\_at | timestamptz | Event timestamp |

**Event Types:**

* summary\\\_generated \- Brief created  
* podcast\\\_searched \- Search session  
* site\\\_visit \- App visit  
* share\\\_initiated \- Share button clicked  
* share\\\_link\\\_visited \- Shared link opened

**audio\_engagement\_events Table**

| Column | Type | Description |
| ----- | :---: | :---: |
| id | uuid | Primary key |
| master\_brief\_id | uuid | FK to master\_briefs |
| user\_id | uuid | User reference |
| audio\_type | text | 'summary' or 'full\_episode' |
| event\_type | text | 'start' or 'completion' |
| progress\_seconds | integer | Playback position |
| progress\_percentage | numeric | Completion percentage |
| duration\_seconds | integer | Total duration |
| session\_id | text | Unique session identifier |
| created\_at | timestamptz | Event timestamp |

**Supporting Tables**

| Table Name | Description |
| ----- | ----- |
| ai\_config | AI model settings (temperatures, TTS voice, footer) |
| ai\_prompts | Dynamic system prompts for extraction/synthesis |
| api\_performance\_logs | Edge function latency tracking |
| error\_logs | Critical error observability |
| ip\_rate\_limits | Daily teaser limit per IP (20/day) |
| duration\_check\_rate\_limits | Rate limiting for API calls |
| user\_roles | Admin role assignments |

**4.2 Credit System Logic**

NEW USER:    

├─ Created with 5 credits (default in profiles table)    

└─ Each brief costs 1 credit (deducted BEFORE pipeline starts)

EPISODE SAVING:

├─ Free \- No credits required

└─ Episodes saved to saved\\\_episodes table

DEDUPLICATION:  

├─ If master\\\_brief exists for (episode\\\_uuid, language) → link user, no credit charge  

└─ Otherwise → create new master\\\_brief and deduct credit

PRO SUBSCRIPTION ($19/mo):  

├─ \+30 credits on initial checkout  

├─ \+30 credits on monthly renewal  

└─ plan \= 'pro' while subscription active

CREDIT REFILL ($5):

├─ \+10 credits (one-time purchase)

└─ Available to Pro users only

**4.3 Row-Level Security (RLS)**

* **Row-Level Security (RLS):** Enabled on all tables with strict policies  
* **Anonymous Access:** Explicitly denied (USING false) on all user data tables  
* **Public Metadata:** podcast\_metadata and episode\_metadata are publicly readable for SEO  
* **Storage RLS:** Audio files in brief-audio bucket protected by ownership check via user\_briefs → master\_briefs join  
* **Admin Access:** Controlled via user\_roles table. Only users with admin role can access admin data.

**5\. File Structure & Routes**

**5.1 Application Routes**

| Route | Page Component | Access | Description |
| ----- | :---: | :---: | :---: |
| / | Index.tsx | Public | Landing page with CTA |
| /signup | SignUp.tsx | Public | Account registration |
| /login | Login.tsx | Public | Auth (Email/Password/Google) |
| /reset-password | ResetPassword.tsx | Public | Password reset flow |
| /library | Library.tsx | Auth | User's saved episodes \+ briefs |
| /brief/:slug | Brief.tsx | Mixed | Brief detail view (public sharing) |
| /search | Search.tsx | Auth | Podcast discovery |
| /shows | Shows.tsx | Auth | My Shows \+ New Episodes feed |
| /podcasts | Shows.tsx | Auth | Alias for /shows |
| /show/:slug | ShowDiscovery.tsx | Public | Show landing page |
| /show/:slug/episodes | ShowEpisodes.tsx | Public | Paginated episodes list |
| /show/:slug/briefs | ShowBriefs.tsx | Public | Paginated briefs list |
| /episode/:slug | EpisodeDetail.tsx | Public | Episode landing page |
| /explore | Explore.tsx | Public | Curated discovery |
| /shows/directory | ShowsDirectory.tsx | Public | Paginated shows index |
| /pricing | Pricing.tsx | Public | Plan comparison |
| /settings | Settings.tsx | Auth | Account & subscription management |
| /install | Install.tsx | Public | PWA installation guide |
| /admin/\* | AdminLayout.tsx | Admin | Admin dashboard (nested routes) |
| /privacy | Privacy.tsx | Public | Privacy policy |
| /terms | Terms.tsx | Public | Terms of service |
| /faq | FAQ.tsx | Public | Frequently asked questions |
| \* | NotFound.tsx | Public | 404 page |

**5.2 Key Directory Structure**

src/  
├── assets/           \# Static images (ES6 imports)  
├── components/  
│   ├── admin/        \# Admin UI (AdminLayout, EditUserModal, etc.)  
│   ├── audio/        \# Audio player (DesktopPlayerBar, MiniPlayerBar, ExpandedPlayer)  
│   ├── brief/        \# Brief UI (BriefDisplay, BriefHeader, SummarySection, etc.)  
│   ├── cards/        \# Reusable card components (ContentCard, CardThumbnail, etc.)  
│   ├── detail/       \# Shared detail page components (hero, actions, CTAs)  
│   ├── landing/      \# Landing page (Header, Footer, Features, HeroBackground)  
│   ├── library/      \# Library components (LibrarySkeleton)  
│   ├── podcasts/     \# Podcast cards (PodcastCardSkeleton)  
│   ├── shows/        \# Shows page (EpisodeCard, NewEpisodesSkeleton)  
│   └── ui/           \# shadcn/ui components  
├── contexts/  
│   ├── AudioPlayerContext.tsx  \# Global audio player state  
│   └── QueueContext.tsx        \# Playback queue management  
├── hooks/  
│   ├── useAuth.tsx             \# Auth context \+ profile management  
│   ├── useAnalytics.ts         \# Event logging utility  
│   ├── useAudioPlayer.ts       \# Audio playback logic  
│   ├── useCheckout.ts          \# Stripe checkout logic (centralized)  
│   ├── useLibraryBriefs.ts     \# Library briefs data  
│   ├── useSavedEpisodes.ts     \# Library episodes data  
│   ├── useMyPodcasts.ts        \# Followed shows management  
│   ├── useNewEpisodes.ts       \# New episodes feed  
│   └── useSessionTracking.ts   \# Site visit tracking  
├── lib/  
│   ├── audioCache.ts           \# IndexedDB audio caching  
│   ├── audioManager.ts         \# Singleton audio element (iOS fix)  
│   ├── audioUtils.ts           \# Shared audio utilities  
│   ├── constants.ts            \# Feature flags, Stripe config  
│   ├── errorLogger.ts          \# Critical error logging  
│   ├── logger.ts               \# Development logging  
│   ├── posthog.ts              \# PostHog analytics  
│   ├── trackingPixels.ts       \# Ad conversion tracking  
│   └── utils.ts                \# Utility functions  
├── pages/                      \# Route components  
└── integrations/supabase/      \# Auto-generated Supabase client \+ types

supabase/  
├── config.toml                 \# Edge function configuration  
├── functions/                  \# \~40 edge functions  
│   ├── \\\_shared/               \# Shared utilities (cors, adminAuth, logger)  
│   └── \[function-name\]/        \# Individual functions  
└── migrations/                \# Database migrations (read-only)

**5.3 Edge Functions (\~40 Total)**

**Brief Generation Pipeline**

| Function | JWT Required | Purpose |
| ----- | :---: | :---: |
| generate-taddy-brief | Yes | Full pipeline: transcript → summary → audio |
| summarize-brief | No | AI summary generation (background) |
| generate-audio | No | OpenAI TTS generation (background) |
| retry-taddy-transcript | Yes | Retry failed transcript fetch |

**Podcast Data**

| Function | JWT Required | Purpose |
| ----- | :---: | :---: |
| taddy-search | Yes | Podcast search via Taddy |
| taddy-podcast-details | Yes | Fetch podcast series details |
| taddy-get-transcript | No | Fetch episode transcript |
| taddy-latest-episodes | Yes | Fetch recent episodes (1-hour cache) |

**Metadata Management**

| Function | JWT Required | Purpose |
| ----- | :---: | :---: |
| ensure-podcast-metadata | Yes | Create/get podcast slug |
| ensure-episode-metadata | Yes | Create/get episode slug |
| get-episode-details | No | Public episode details |
| get-show-discovery | No | Show page data |
| get-show-episodes | No | Paginated episodes |
| get-show-briefs | No | Paginated briefs |
| get-explore-shows | No | Curated explore data |

**Content Access**

| Function | JWT Required | Purpose |
| ----- | :---: | :---: |
| claim-brief | Yes | Add shared brief to library |
| claim-episode | Yes | Save episode to library |
| get-public-brief-preview | No | Truncated brief for public viewing |
| get-signed-audio-url | Yes | Generate signed URL for audio |

**Billing & Payments**

| Function | JWT Required | Purpose |
| ----- | :---: | :---: |
| create-checkout | Yes | Stripe checkout session |
| create-credit-refill | Yes | Stripe checkout for credit pack |
| customer-portal | Yes | Stripe billing portal |
| cancel-subscription | Yes | Immediate subscription cancellation |
| stripe-webhook | No | Stripe event handler |

**User Management**

| Function | JWT Required | Purpose |
| ----- | :---: | :---: |
| delete-user | Yes | User self-deletion |
| sync-to-loops | No | Sync user data to Loops.so |

**Admin Functions**

| Function | JWT Required | Purpose |
| ----- | :---: | :---: |
| admin-check-role | Yes | Verify admin access |
| admin-list-users | Yes | Paginated user list with stats |
| admin-update-user | Yes | Edit user credits/plan |
| admin-delete-user | Yes | Delete user account |
| admin-analytics | Yes | Usage metrics |
| admin-performance | Yes | API latency data |
| admin-costs | Yes | Cost analysis |
| admin-error-logs | Yes | Error log retrieval |
| admin-resolve-error | Yes | Mark error resolved |

**Utilities**

| Function | JWT Required | Purpose |
| ----- | ----- | ----- |
| log-error | No | Frontend error logging |
| log-share-visit | No | Track share link visits |
| send-brief-ready-email | No | Email notification via Resend |
| send-internal-notification | No | Internal alerts |
| sitemap | No | Dynamic sitemap generation |
| backfill-loops | No | Backfill Loops.so data |
| cleanup-youtube-data | No | Legacy data cleanup |

**6\. Business Logic — Brief Generation Pipeline**

**6.1 Pipeline States**

pending → transcribing → summarizing → recording → completed

                                                    ↓

                                   failed (with pipeline\\\_error)

**6.2 Lock Mechanism**

Concurrent processing is prevented via processing\\\_lock\\\_holder column with unique lock IDs.

**6.3 Stale Recovery Logic**

Briefs stuck in a processing state for \>10 minutes are automatically recovered:

* If summary exists → mark as 'completed'  
* If only transcript exists → mark as 'pending' for manual retry

**6.4 Content Deduplication**

User requests brief for Episode X in English

├─ Check: Does master\\\_briefs have (taddy\\\_episode\\\_uuid=X, language='en')?

│   ├─ YES → Link user\\\_briefs to existing master\\\_brief (no credit charge)

│   └─ NO  → Deduct credit, create new master\\\_brief, start pipeline

**7\. Business Logic — Subscription Flow**

**7.1 Upgrade Flow (Stripe Checkout)**

1. User clicks **"Upgrade to Pro"** → create-checkout function  
2. Stripe Checkout session opens in new tab  
3. On payment success, Stripe fires checkout.session.completed webhook  
4. stripe-webhook increments credits by **30** and sets plan to **'pro'**  
5. sync-to-loops updates Loops.so contact with plan='pro'

**7.2 Monthly Renewal Flow**

1. Stripe subscription renews  
2. Stripe fires invoice.paid (billing\_reason \!= 'subscription\_create')  
3. stripe-webhook adds 30 credits  
4. Updates pro\_expires\_at

**7.3 Cancellation Sequence (Immediate)**

1. User clicks **"Cancel Subscription"** in Settings or Stripe Portal  
2. Stripe terminates the subscription **immediately**  
3. Stripe fires customer.subscription.deleted webhook  
4. stripe-webhook sets plan to **'free'**  
5. sync-to-loops updates Loops.so contact with plan='free'  
6. **Note:** User credits are **not** wiped; they remain available

**7.4 Pricing Configuration**

Free Tier:      5 credits (one-time) \+ unlimited listening

Pro Plan:       $19/month for 30 credits

Credit Refill:  $5 for 10 credits (one-time, Pro users only)

**8\. Admin & Analytics**

**8.1 Admin Dashboard (/admin)**

**Access Control:** Requires admin role in user\_roles table

**Sub-routes:**

* /admin/users \- User management  
* /admin/briefs \- All briefs overview  
* /admin/analytics \- Usage metrics (Briefs, Shares, Revenue tabs)  
* /admin/performance \- API latency tracking  
* /admin/costs \- TTS and AI cost monitoring  
* /admin/errors \- Error logs  
* /admin/config \- AI prompts and settings

**8.2 Analytics Metrics Tracked**

**User Stats (per user):**

* Searches count  
* Shows followed  
* Episodes saved  
* Briefs generated  
* Share link visits  
* Referrals  
* Total site visits  
* Last seen

**Global Stats:**

* Total briefs generated  
* Summary plays (30s+ threshold)  
* Summary completions (75% threshold)  
* Episode plays  
* Episode completions  
* Average audio length

**8.3 Cost Monitoring (/admin/costs)**

Tracks per-brief costs for:

* **TTS (OpenAI):** $0.015 per 1,000 characters  
* **AI Summary (Gemini):** $0.50 per 1M input tokens, $3.00 per 1M output tokens  
* **Target:** \~$0.15 total per brief

**8.4 AI Configuration (/admin/config)**

Configurable parameters:

* Extraction temperature (Phase 1\)  
* Synthesis temperature (Phase 2\)  
* OpenAI TTS voice selection  
* Summary footer text  
* System prompts for extraction and synthesis

**9\. Marketing Integrations**

**9.1 Loops.so Integration**

**Purpose:** Marketing automation and contact management

**Synced Properties:**

* userId  
* email  
* firstName  
* plan (string: "free", "pro")  
* credits  
* preferredLanguage  
* showsFollowed  
* briefsGenerated  
* lastBriefDate  
* signupDate

**Trigger Points:**

* User signup → 'signup' action  
* Subscription upgrade → 'upgraded' action  
* Subscription cancellation → 'downgraded' action  
* Brief generation → 'engagement\_update' action

**9.2 PostHog Integration**

**Purpose:** Product analytics, session replays, heatmaps

**Environment:** Production only (import.meta.env.MODE \=== 'production')

**Key Events:**

* Page views  
* User identification  
* Summary generation  
* Feature usage

**10\. Deployment Status**

**10.1 Dual Environment Architecture**

| Environment | Purpose | Data |
| ----- | ----- | ----- |
| **Test** | Development & testing | Isolated test data |
| **Live** | Production | Real user data |

**Key Behavior:**

* Database writes only affect Test  
* Database reads can target either environment  
* Publishing deploys code and schema from Test to Live  
* Data is never synced between environments

**10.2 Current Environment**

| Component | Configuration |
| ----- | ----- |
| Frontend | Vite build → Lovable hosting |
| Backend | Lovable Cloud (Supabase) |
| Edge Functions | Auto-deployed via Lovable |
| Database | PostgreSQL (Supabase managed) |
| CDN | Lovable edge network |
| Sitemap | Cloudflare Worker (sitemap.podbrief.io) |

**10.3 Production URLs**

* **App:** [https://podbrief.io](https://podbrief.io)  
* **Sitemap:** [https://sitemap.podbrief.io/sitemap.xml](https://sitemap.podbrief.io/sitemap.xml)

**10.4 Supabase Secrets (15+ Total)**

| Secret | Purpose |
| ----- | :---: |
| ALLOWED\_ORIGIN | CORS origin validation |
| GOOGLE\_GEMINI\_API\_KEY | AI summarization (Gemini) |
| OPENAI\_API\_KEY | Text-to-Speech generation |
| TADDY\_API\_KEY | Podcast data API |
| TADDY\_USER\_ID | Taddy account identifier |
| RESEND\_API\_KEY | Email delivery |
| LOOPS\_API\_KEY | Marketing automation |
| STRIPE\_SECRET\_KEY | Stripe API access |
| STRIPE\_WEBHOOK\_SECRET | Webhook signature verification |
| STRIPE\_PRICE\_ID | Pro subscription price |
| STRIPE\_CREDIT\_REFILL\_PRICE\_ID | Credit pack price |
| TURNSTILE\_SECRET\_KEY | Bot protection verification |

**10.5 Feature Flags**  
// src/lib/constants.ts — ALL should be false in production  
SHOW\\\_REGENERATE\\\_SUMMARY \= false  // Hide regenerate button from users

**11\. Cost Vectors**

**11.1 Variable Costs (Per-Use)**

| Service | Unit | Cost | Triggered By |
| ----- | :---: | :---: | :---: |
| **Taddy** | Per transcript | \~$0.005 | Every new brief |
| **Gemini 3 Flash** | Per 1M tokens | $0.50 in / $3.00 out | Summarization |
| **OpenAI TTS-1** | Per 1K chars | $0.015 | Audio generation |
| **Supabase Storage** | Per GB/mo | \~$0.021 | Audio file storage |
| **Stripe Fee** | Per transaction | 2.9% \+ $0.30 | Subscription/purchase |
| **Resend** | Per email | \~$0.001 | Brief ready notification |
| **Loops** | Per contact | Included | Marketing automation |

**11.2 Estimated Cost Per Brief**

| Component | Estimated Cost |
| ----- | :---: |
| Taddy Transcript | \~$0.005 |
| Gemini AI (both phases) | \~$0.02-0.04 |
| OpenAI TTS | \~$0.10-0.12 |
| Storage \+ Misc | \~$0.01 |
| **Total** | **\~$0.15-0.18** |

**11.3 Scaling Projections**  
Assuming average user generates 1 brief per day (30 per month):

| Active Users | Briefs/mo | Est. Variable Cost |
| ----- | :---: | :---: |
| 100 | 3,000 | \~$450-540/mo |
| 1,000 | 30,000 | \~$4,500-5,400/mo |
| 10,000 | 300,000 | \~$45,000-54,000/mo |

**12\. Unit Economics**

**12.1 Net Revenue Analysis ($19/mo Plan)**

| Component | Calculation | Value |
| ----- | :---: | :---: |
| Gross Revenue | Monthly subscription | $19.00 |
| Stripe Fee | 2.9% \+ $0.30 | ($0.85) |
| Net Revenue | Amount received | $18.15 |

**12.2 Margin Analysis (Full Usage: 30 Briefs/Month)**

| Component | Calculation | Value |
| ----- | ----- | ----- |
| Net Revenue | After Stripe fees | $18.15 |
| API Costs | 30 × $0.15 avg | ($4.50) |
| Infrastructure | Edge functions / storage | (\~$0.10) |
| **Net Profit** | Per power user | \*\*$13.55\*\* |
| **Net Margin** | Efficiency ratio | **\~75%** |

**13\. Appendix — Quick Reference**

**13.1 AI Pipeline (Two-Pass)**

**Phase 1 — Extraction (AI Condensed Transcript):**

* Input: Full timestamped transcript  
* Output: High-resolution, timestamped condensed version  
* Model: Gemini 3 Flash Preview  
* Temperature: Configurable (default 0.1)

**Phase 2 — Synthesis (Executive Brief):**

* Input: AI Condensed Transcript  
* Output: \<1000 word structured summary  
* Model: Gemini 3 Flash Preview  
* Temperature: Configurable (default 0.1)  
* Dynamic Resolution Scaling: Section count based on duration

**13.2 Caching Strategy**

| Data | Cache Type | Duration | Invalidation |
| ----- | :---: | :---: | :---: |
| Search results | sessionStorage | 30 min | Manual search |
| New Episodes feed | sessionStorage | 1 hour | Shows change or manual refresh |
| Audio files | IndexedDB | 24 hours | LRU eviction |

**13.3 Rate Limits**

| Limit | Value | Reset |
| ----- | :---: | :---: |
| Briefs per IP (unauth) | 20/day | Daily |
| Duration checks per IP | 10/5 min | Rolling window |

**13.4 Audio Engagement Thresholds**

| Event | Threshold |
| ----- | ----- |
| Start event logged | 30 seconds of accumulated listening |
| Completion event logged | 75% of total duration reached |

**13.5 Supported Languages**

Chinese, Dutch, English, French, German, Italian, Japanese, Korean, Polish, Portuguese, Russian, Spanish-----*Document generated: January 28, 2026*  
*Version: 2.1*  
